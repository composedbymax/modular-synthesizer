<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modular Synthesizer with Automation</title>
  <style>
    body { background: #1a1a1a; color: #e0e0e0; font-family: 'Courier New', monospace; margin: 0; padding: 20px; }
    .synth-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    .module { background: #2a2a2a; border: 2px solid #3a3a3a; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
    .module h2 { color: #00ff9d; margin-top: 0; border-bottom: 2px solid #3a3a3a; padding-bottom: 10px; }
    .control { margin: 15px 0; }
    .control label { display: block; margin-bottom: 5px; color: #00ff9d; }
    input[type="range"] { width: 100%; background: #3a3a3a; height: 8px; border-radius: 4px; -webkit-appearance: none; appearance: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #00ff9d; border-radius: 50%; cursor: pointer; }
    select { width: 100%; padding: 8px; background: #3a3a3a; color: #e0e0e0; border: 1px solid #4a4a4a; border-radius: 4px; }
    .button-container { display: flex; gap: 10px; margin-top: 20px; }
    button { background: #00ff9d; color: #1a1a1a; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1; }
    button:hover { background: #00cc7a; }
    .led { display: inline-block; width: 12px; height: 12px; background: #333; border-radius: 50%; margin-right: 10px; }
    .led.active { background: #00ff9d; box-shadow: 0 0 10px #00ff9d; }
    .value-display { font-family: 'Courier New', monospace; color: #00ff9d; text-align: right; margin-top: 5px; }
    .automation-control { border-top: 2px solid #3a3a3a; margin-top: 15px; padding-top: 15px; }
  </style>
</head>
<body>
  <div class="synth-container">
    <div class="module">
      <h2>Oscillator</h2>
      <div class="control">
        <label>Waveform</label>
        <select id="waveform">
          <option value="sine">Sine</option>
          <option value="square">Square</option>
          <option value="sawtooth">Sawtooth</option>
          <option value="triangle">Triangle</option>
        </select>
      </div>
      <div class="control">
        <label>Frequency: <span id="frequencyDisplay">440</span> Hz</label>
        <input type="range" id="frequency" min="20" max="2000" value="440">
        <div class="automation-control">
          <button id="autoFrequency">Auto Frequency</button>
          <label>Speed: <input type="range" id="frequencySpeed" min="0.1" max="5" step="0.1" value="1"></label>
        </div>
      </div>
    </div>
    <div class="module">
      <h2>Filter</h2>
      <div class="control">
        <label>Cutoff: <span id="filterDisplay">1000</span> Hz</label>
        <input type="range" id="filter" min="20" max="5000" value="1000">
        <div class="automation-control">
          <button id="autoFilter">Auto Filter</button>
          <label>Speed: <input type="range" id="filterSpeed" min="0.1" max="5" step="0.1" value="1"></label>
        </div>
      </div>
      <div class="control">
        <label>Resonance: <span id="resonanceDisplay">0</span></label>
        <input type="range" id="resonance" min="0" max="20" value="0">
      </div>
    </div>
    <div class="module">
      <h2>LFO</h2>
      <div class="control">
        <label>Rate: <span id="lfoRateDisplay">2</span> Hz</label>
        <input type="range" id="lfoRate" min="0.1" max="20" step="0.1" value="2">
        <div class="automation-control">
          <button id="autoLfoRate">Auto LFO Rate</button>
          <label>Speed: <input type="range" id="lfoRateSpeed" min="0.1" max="5" step="0.1" value="1"></label>
        </div>
      </div>
      <div class="control">
        <label>Depth: <span id="lfoDepthDisplay">50</span>%</label>
        <input type="range" id="lfoDepth" min="0" max="100" value="50">
      </div>
    </div>
    <div class="module">
      <h2>Output</h2>
      <div class="control">
        <label>Master Volume: <span id="volumeDisplay">50</span>%</label>
        <input type="range" id="volume" min="0" max="100" value="50">
      </div>
      <div class="button-container">
        <button id="powerBtn">Start</button>
      </div>
      <div class="led" id="powerLed"></div>
    </div>
  </div>
  <script>
    let audioContext = null;
    let oscillator = null;
    let gainNode = null;
    let filter = null;
    let lfo = null;
    let lfoGain = null;
    let isPlaying = false;

    // Automation state
    const automations = {
      frequency: { active: false, animation: null },
      filter: { active: false, animation: null },
      lfoRate: { active: false, animation: null }
    };

    const controls = {
      waveform: document.getElementById('waveform'),
      frequency: document.getElementById('frequency'),
      filter: document.getElementById('filter'),
      resonance: document.getElementById('resonance'),
      lfoRate: document.getElementById('lfoRate'),
      lfoDepth: document.getElementById('lfoDepth'),
      volume: document.getElementById('volume'),
      powerBtn: document.getElementById('powerBtn'),
      powerLed: document.getElementById('powerLed'),
      // Automation controls
      frequencySpeed: document.getElementById('frequencySpeed'),
      filterSpeed: document.getElementById('filterSpeed'),
      lfoRateSpeed: document.getElementById('lfoRateSpeed'),
      autoFrequency: document.getElementById('autoFrequency'),
      autoFilter: document.getElementById('autoFilter'),
      autoLfoRate: document.getElementById('autoLfoRate')
    };

    const displays = {
      frequency: document.getElementById('frequencyDisplay'),
      filter: document.getElementById('filterDisplay'),
      resonance: document.getElementById('resonanceDisplay'),
      lfoRate: document.getElementById('lfoRateDisplay'),
      lfoDepth: document.getElementById('lfoDepthDisplay'),
      volume: document.getElementById('volumeDisplay')
    };

    function initAudio() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      oscillator = audioContext.createOscillator();
      gainNode = audioContext.createGain();
      filter = audioContext.createBiquadFilter();
      lfo = audioContext.createOscillator();
      lfoGain = audioContext.createGain();
      
      oscillator.type = controls.waveform.value;
      oscillator.frequency.setValueAtTime(controls.frequency.value, audioContext.currentTime);
      
      filter.type = 'lowpass';
      filter.frequency.setValueAtTime(controls.filter.value, audioContext.currentTime);
      filter.Q.setValueAtTime(controls.resonance.value, audioContext.currentTime);
      
      lfo.frequency.setValueAtTime(controls.lfoRate.value, audioContext.currentTime);
      lfoGain.gain.setValueAtTime(controls.lfoDepth.value / 100 * 100, audioContext.currentTime);
      gainNode.gain.setValueAtTime(controls.volume.value / 100, audioContext.currentTime);
      
      lfo.connect(lfoGain);
      lfoGain.connect(oscillator.frequency);
      oscillator.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.start();
      lfo.start();
    }

    function updateAll() {
      if (!isPlaying) return;
      oscillator.type = controls.waveform.value;
      filter.frequency.setValueAtTime(parseFloat(controls.filter.value), audioContext.currentTime);
      filter.Q.setValueAtTime(parseFloat(controls.resonance.value), audioContext.currentTime);
      lfo.frequency.setValueAtTime(parseFloat(controls.lfoRate.value), audioContext.currentTime);
      lfoGain.gain.setValueAtTime(parseFloat(controls.lfoDepth.value), audioContext.currentTime);
      gainNode.gain.setValueAtTime(controls.volume.value / 100, audioContext.currentTime);
    }

    // Automation functions
    function automateParameter(param, min, max, speed) {
      let time = 0;
      return {
        start: () => {
          const animate = () => {
            time += 0.016;  // Approximately 60fps
            const value = min + (Math.sin(time * speed) + 1) / 2 * (max - min);
            controls[param].value = value;
            displays[param].textContent = Math.round(value);
            if (isPlaying) {
              switch(param) {
                case 'frequency':
                  oscillator.frequency.setValueAtTime(value, audioContext.currentTime);
                  break;
                case 'filter':
                  filter.frequency.setValueAtTime(value, audioContext.currentTime);
                  break;
                case 'lfoRate':
                  lfo.frequency.setValueAtTime(value, audioContext.currentTime);
                  break;
              }
            }
            if (automations[param].active) {
              automations[param].animation = requestAnimationFrame(animate);
            }
          };
          animate();
        },
        stop: () => {
          if (automations[param].animation) {
            cancelAnimationFrame(automations[param].animation);
            automations[param].animation = null;
          }
        }
      };
    }

    // Setup automation controls
    controls.autoFrequency.addEventListener('click', () => {
      automations.frequency.active = !automations.frequency.active;
      controls.autoFrequency.textContent = automations.frequency.active ? 'Stop Auto' : 'Auto Frequency';
      if (automations.frequency.active) {
        automateParameter('frequency', 20, 2000, parseFloat(controls.frequencySpeed.value)).start();
      } else {
        automations.frequency.stop();
      }
    });

    controls.autoFilter.addEventListener('click', () => {
      automations.filter.active = !automations.filter.active;
      controls.autoFilter.textContent = automations.filter.active ? 'Stop Auto' : 'Auto Filter';
      if (automations.filter.active) {
        automateParameter('filter', 20, 5000, parseFloat(controls.filterSpeed.value)).start();
      } else {
        automations.filter.stop();
      }
    });

    controls.autoLfoRate.addEventListener('click', () => {
      automations.lfoRate.active = !automations.lfoRate.active;
      controls.autoLfoRate.textContent = automations.lfoRate.active ? 'Stop Auto' : 'Auto LFO Rate';
      if (automations.lfoRate.active) {
        automateParameter('lfoRate', 0.1, 20, parseFloat(controls.lfoRateSpeed.value)).start();
      } else {
        automations.lfoRate.stop();
      }
    });

    // Basic control event listeners
    controls.frequency.addEventListener('input', (e) => {
      displays.frequency.textContent = e.target.value;
      if (isPlaying) {
        oscillator.frequency.setValueAtTime(parseFloat(e.target.value), audioContext.currentTime);
      }
    });

    controls.powerBtn.addEventListener('click', () => {
      if (!isPlaying) {
        initAudio();
        isPlaying = true;
        controls.powerBtn.textContent = 'Stop';
        controls.powerLed.classList.add('active');
      } else {
        Object.keys(automations).forEach(key => {
          if (automations[key].active) {
            automations[key].stop();
            automations[key].active = false;
            const buttonId = 'auto' + key.charAt(0).toUpperCase() + key.slice(1);
            if (controls[buttonId]) {
              controls[buttonId].textContent = 'Auto ' + key.charAt(0).toUpperCase() + key.slice(1);
            }
          }
        });
        audioContext.close();
        audioContext = null;
        isPlaying = false;
        controls.powerBtn.textContent = 'Start';
        controls.powerLed.classList.remove('active');
      }
    });

    Object.keys(controls).forEach(key => {
      if (key !== 'powerBtn' && key !== 'powerLed' && key !== 'frequency' && !key.startsWith('auto')) {
        controls[key].addEventListener('input', (e) => {
          if (displays[key]) {
            displays[key].textContent = e.target.value;
          }
          updateAll();
        });
      }
    });
  </script>
</body>
</html>
